upstream api {
    server localhost:8000;
}

server {
    listen 8080;
    server_name _;

    root /data/http;
    index index.html;

    client_max_body_size 5G;

    # Serve static files
    location ~* \.(bin|elf|img|dat|txt)$ {
        add_header Cache-Control "public, max-age=3600";
        try_files $uri =404;
    }

    # Proxy OS installers
    location /os/ {
        autoindex on;
        try_files $uri $uri/ =404;
    }

    # Proxy iPXE and kernel requests
    location /raspi/ {
        autoindex off;
        try_files $uri =404;
    }

    # Proxy ipxe scripts
    location /ipxe/ {
        add_header Content-Type text/plain;
        try_files $uri =404;
    }

    # Health check
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}
