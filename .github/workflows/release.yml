name: Create Release

on:
  push:
    tags:
      - '[0-9]{4}-[0-9]{2}-[0-9]{2}-V[0-9]+'

jobs:
  create-release:
    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
    - uses: actions/checkout@v3

    - name: Extract version
      id: version
      run: |
        TAG=${{ github.ref }}
        VERSION=${TAG#refs/tags/}
        echo "version=$VERSION" >> $GITHUB_OUTPUT
        echo "Version: $VERSION"

    - name: Generate release notes
      id: release
      run: |
        VERSION=${{ steps.version.outputs.version }}
        
        # Extract from CHANGELOG
        echo "## Release: $VERSION" > RELEASE_NOTES.md
        echo "" >> RELEASE_NOTES.md
        
        if grep -A 50 "## \[$VERSION\]" CHANGELOG.md > /dev/null; then
          tail -n +2 <(grep -A 50 "## \[$VERSION\]" CHANGELOG.md | head -n -1) >> RELEASE_NOTES.md
        else
          echo "Release notes to be added." >> RELEASE_NOTES.md
        fi

    - name: Create GitHub Release
      uses: ncipollo/release-action@v1
      with:
        tag: ${{ steps.version.outputs.version }}
        bodyFile: RELEASE_NOTES.md
        draft: false
        prerelease: false

    - name: Notify on Release
      run: |
        VERSION=${{ steps.version.outputs.version }}
        echo "âœ“ Release $VERSION created successfully!"
        echo "ðŸŽ‰ Available at: https://github.com/${{ github.repository }}/releases/tag/$VERSION"
